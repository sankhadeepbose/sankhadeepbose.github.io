<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sankhadeep Bose – Publications</title>
  <!--
    Minimal academic website: publications page.
    Publications are loaded from a BibTeX file and formatted using Citation.js
    with the AIP CSL style from Zotero.
  -->
  <link rel="stylesheet" href="styles.css">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <!-- Academicons for Google Scholar / ORCID icons -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.1/css/academicons.min.css">
</head>
<body>
  <div class="container">
    <!-- Sidebar with photo and contact links -->
    <aside class="sidebar">
      <img src="images/profile.jpg" alt="Profile photo">

      <div class="contact-links">
        <!-- Google Scholar icon -->
        <a href="[https://scholar.google.com/citations?user=YOUR_ID]"
           title="Google Scholar" target="_blank" rel="noopener">
          <i class="ai ai-google-scholar-square"></i>
        </a>
        <!-- ResearchGate icon -->
        <a href="[https://www.researchgate.net/profile/YOUR_PROFILE]"
           title="ResearchGate" target="_blank" rel="noopener">
          <i class="fab fa-researchgate"></i>
        </a>
        <!-- LinkedIn icon -->
        <a href="[https://www.linkedin.com/in/yourprofile]"
           title="LinkedIn" target="_blank" rel="noopener">
          <i class="fab fa-linkedin"></i>
        </a>
        <!-- ORCID icon -->
        <a href="[https://orcid.org/0000-0000-0000-0000]"
           title="ORCID" target="_blank" rel="noopener">
          <i class="ai ai-orcid"></i>
        </a>
        <!-- GitHub icon -->
        <a href="[https://github.com/yourusername]"
           title="GitHub" target="_blank" rel="noopener">
          <i class="fab fa-github"></i>
        </a>
      </div>

      <!-- Explicit email address below the icons -->
      <p class="contact-email">
        <i class="fas fa-envelope"></i> bose.sankhadeep@pm.me
      </p>
    </aside>

    <!-- Main content area -->
    <div class="main-content">
      <header>
        <h1>Sankhadeep Bose</h1>
        <p>PhD student specializing in Thermodynamics, Statistical Mechanics, and Atomistic Simulations.</p>
        <p><strong>Current Affiliation</strong> – School of Mechanical Engineering, Vellore Institute Of Technology, Vellore, Tamil Nadu, India.</p>
      </header>

      <!-- Primary navigation -->
      <nav>
        <ul>
          <li><a href="index.html">About</a></li>
          <li><a href="research.html">Research</a></li>
          <li><a href="publications.html" class="active">Publications</a></li>
        </ul>
      </nav>

      <main>
        <section id="publications">
          <h2>Publications</h2>
          <div id="pub-list">Loading publications…</div>
        </section>
      </main>

      <footer>
        <p>&copy; 2025 Sankhadeep Bose. All rights reserved.</p>
      </footer>
    </div>
  </div>

  <!-- Monolithic Citation.js (includes BibTeX + CSL plugins) -->
  <script src="https://cdn.jsdelivr.net/npm/citation-js@0.7.18/build/citation.min.js"></script>

  <script>
    const Cite = window.Cite;
    if (!Cite) {
      console.error('Citation.js did not load correctly.');
    }

    // Load and register the AIP CSL style from Zotero
    let aipTemplateLoaded = false;
    async function ensureAIPTemplate () {
      if (aipTemplateLoaded) return;

      const config = Cite.plugins.config.get('csl');
      try {
        if (config.templates.has && config.templates.has('aip')) {
          aipTemplateLoaded = true;
          return;
        }
      } catch (e) {
        // if .has is not available, we just proceed to load
      }

      const res = await fetch('https://www.zotero.org/styles/american-institute-of-physics');
      if (!res.ok) {
        throw new Error('Failed to fetch AIP CSL style: ' + res.status);
      }
      const style = await res.text();
      config.templates.add('aip', style);
      aipTemplateLoaded = true;
    }

    // Very simple BibTeX field parser (enough for our limited, clean entries)
    function parseBibFields (entry) {
      const fields = {};
      // Strip leading '@type{key,' part
      const bodyStart = entry.indexOf('{');
      if (bodyStart === -1) return fields;
      const body = entry.slice(bodyStart + 1);

      // Split on newlines; parse lines of the form: key = {value},
      const lines = body.split(/\n/);
      for (let line of lines) {
        line = line.trim();
        // stop at closing brace
        if (line.startsWith('}')) break;
        const m = line.match(/^([A-Za-z]+)\s*=\s*[{"](.+?)[}"],?\s*$/);
        if (m) {
          const key = m[1].toLowerCase();
          const value = m[2].trim();
          fields[key] = value;
        }
      }
      return fields;
    }

    // Convert month field (string or number) to numeric month
    function parseMonth (monthRaw) {
      if (!monthRaw) return 0;
      const mNum = parseInt(monthRaw, 10);
      if (!isNaN(mNum)) return mNum;

      const short = monthRaw.toLowerCase().slice(0, 3);
      const map = {
        jan: 1, feb: 2, mar: 3, apr: 4, may: 5, jun: 6,
        jul: 7, aug: 8, sep: 9, oct: 10, nov: 11, dec: 12
      };
      return map[short] || 0;
    }

    // Extract BibTeX key from entry
    function extractBibKey (entry) {
      const m = entry.match(/^@\w+\s*\{\s*([^,]+),/);
      return m ? m[1].trim() : 'entry';
    }

    async function loadPublications () {
      const container = document.getElementById('pub-list');

      try {
        await ensureAIPTemplate();

        const response = await fetch('publications.bib');
        if (!response.ok) {
          throw new Error('Network response was not ok (status ' + response.status + ')');
        }

        let bibText = await response.text();

        // Remove comment lines starting with '%' and trim
        bibText = bibText.replace(/^\s*%.*$/gm, '').trim();
        if (!bibText) {
          throw new Error('BibTeX file is empty after removing comments.');
        }

        // Split into entries on newline + '@'
        const rawEntries = bibText.split(/\n@/).filter(e => e.trim());
        const entries = rawEntries.map(entry => {
          const trimmed = entry.trim();
          return trimmed.startsWith('@') ? trimmed : '@' + trimmed;
        });

        const categories = { peer: [], thesis: [] };

        entries.forEach(entry => {
          const typeMatch = entry.match(/^@(\w+)/i);
          const type = typeMatch ? typeMatch[1].toLowerCase() : '';
          const fields = parseBibFields(entry);
          const year = fields.year ? parseInt(fields.year, 10) : 0;
          const month = parseMonth(fields.month);

          const item = { entry, fields, year, month };

          if (type === 'article') {
            categories.peer.push(item);
          } else if (type.includes('thesis')) {
            categories.thesis.push(item);
          } else {
            categories.peer.push(item); // fallback
          }
        });

        // Sort by (year desc, month desc)
        const sortDesc = (a, b) => {
          if (b.year !== a.year) return b.year - a.year;
          return b.month - a.month;
        };
        categories.peer.sort(sortDesc);
        categories.thesis.sort(sortDesc);

        // Clear container
        container.innerHTML = '';

        // Helper to render one category
        const renderList = (items, headingText) => {
          if (!items.length) return;

          const h3 = document.createElement('h3');
          h3.textContent = headingText;
          container.appendChild(h3);

          const ol = document.createElement('ol');
          ol.setAttribute('reversed', '');
          ol.start = items.length;

          items.forEach(item => {
            const { entry, fields } = item;

            // ---- Format citation in AIP style via CSL template 'aip' ----
            const cite = new Cite(entry);
            const html = cite.format('bibliography', {
              format: 'html',
              template: 'aip',
              lang: 'en-US'
            });

            const temp = document.createElement('div');
            temp.innerHTML = html;
            const cslEntry = temp.querySelector('.csl-entry') || temp;

            const li = document.createElement('li');
            li.innerHTML = cslEntry.innerHTML;

            // ---- Buttons: PDF, Article page, BibTeX ----
            const linksDiv = document.createElement('div');
            linksDiv.className = 'pub-links';

            // 1) PDF: prefer 'eprint' (often a PDF or DOI), fall back to URL/doi if missing
            const pdfUrl = fields.eprint ||
                           fields.url ||
                           fields.url?.toLowerCase?.() ||
                           fields.doi && ('https://doi.org/' + fields.doi);

            if (pdfUrl) {
              const aPdf = document.createElement('a');
              aPdf.textContent = 'PDF';
              aPdf.href = pdfUrl;
              aPdf.target = '_blank';
              aPdf.rel = 'noopener';
              aPdf.className = 'pub-btn';
              linksDiv.appendChild(aPdf);
            }

            // 2) Article page: use URL or DOI
            const webUrl = fields.url ||
                           fields.URL ||
                           (fields.doi ? 'https://doi.org/' + fields.doi : '');
            if (webUrl) {
              const aWeb = document.createElement('a');
              aWeb.textContent = 'Article page';
              aWeb.href = webUrl;
              aWeb.target = '_blank';
              aWeb.rel = 'noopener';
              aWeb.className = 'pub-btn';
              linksDiv.appendChild(aWeb);
            }

            // 3) BibTeX: construct a downloadable blob from this entry
            const key = extractBibKey(entry);
            const aBib = document.createElement('a');
            aBib.textContent = 'BibTeX';
            aBib.className = 'pub-btn';
            const bibContent = entry.trim() + '\n';
            aBib.href = 'data:text/plain;charset=utf-8,' +
                        encodeURIComponent(bibContent);
            aBib.download = key + '.bib';
            linksDiv.appendChild(aBib);

            li.appendChild(linksDiv);
            ol.appendChild(li);
          });

          container.appendChild(ol);
        };

        renderList(categories.peer, 'In Peer-Reviewed Journals');
        renderList(categories.thesis, 'Theses');
      } catch (err) {
        console.error('Failed to load publications:', err);
        container.textContent = 'Unable to load publications. Please check your .bib file.';
      }
    }

    document.addEventListener('DOMContentLoaded', loadPublications);
  </script>
</body>
</html>
